<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphMind AI</title>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Cytoscape -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <script src="https://unpkg.com/layout-base/layout-base.js"></script>
    <script src="https://unpkg.com/cose-base/cose-base.js"></script>
    <script src="https://unpkg.com/cytoscape-fcose/cytoscape-fcose.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fa-solid fa-circle-nodes"></i> GraphMind</h2>
            </div>

            <div class="controls">
                <!-- Search -->
                <div class="control-group">
                    <input type="text" id="search-input" placeholder="Search nodes...">
                    <button onclick="searchGraph()" class="icon-btn"><i
                            class="fa-solid fa-magnifying-glass"></i></button>
                </div>

                <!-- Source Filter -->
                <div class="control-group">
                    <select id="source-filter" onchange="searchGraph()" class="styled-select">
                        <option value="">All Sources</option>
                        {% for source in sources %}
                        <option value="{{ source }}">{{ source }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Confidence Filter -->
                <div class="control-group">
                    <input type="number" step="0.01" min="0" max="1" id="min-conf-input" placeholder="Min confidence (e.g. 0.5)">
                    <button onclick="applyMinConfidence()" class="icon-btn" title="Apply confidence filter"><i class="fa-solid fa-filter"></i></button>
                </div>

                <!-- Actions -->
                <div class="control-group">
                    <button onclick="refreshGraph()" class="refresh-btn" title="Refresh Graph">
                        <i class="fa-solid fa-rotate-right"></i>
                    </button>
                    <button onclick="clearGraph()" class="refresh-btn danger-btn" title="Clear Graph">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                    <button onclick="triggerFileSelect()" class="refresh-btn" title="Upload Files"
                        style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
                        <i class="fa-solid fa-upload"></i>
                    </button>
                    <a href="/query" class="refresh-btn" title="Cypher Query"
                        style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
                        <i class="fa-solid fa-terminal"></i>
                    </a>
                    <a href="/review" class="refresh-btn" title="Review Relations"
                        style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
                        <i class="fa-solid fa-clipboard-check"></i>
                    </a>
                    <a href="/files" class="refresh-btn" title="Manage Files"
                        style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
                        <i class="fa-solid fa-folder-open"></i>
                    </a>
                </div>

                <!-- Layout Toggle -->
                <div class="control-group" style="margin-top: 10px;">
                    <select id="layout-select" class="styled-select" onchange="applyLayoutFromSelect()">
                        <option value="fcose">fcose (auto)</option>
                        <option value="cose">cose</option>
                        <option value="grid">grid</option>
                        <option value="concentric">concentric</option>
                    </select>
                </div>

                <!-- URL Import -->
                <div class="control-group" style="margin-top: 10px;">
                    <input type="text" id="url-input" placeholder="Import from URL...">
                    <button onclick="processUrl()" class="icon-btn"><i class="fa-solid fa-globe"></i></button>
                </div>

                <!-- Export Subgraph -->
                <div class="control-group" style="margin-top: 10px;">
                    <input type="text" id="export-seed" placeholder="Seed id (optional)">
                    <input type="number" id="export-depth" placeholder="Depth" value="1" style="width:80px">
                    <select id="export-format" class="styled-select" style="max-width:120px">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="graphml">GraphML</option>
                    </select>
                    <button onclick="exportSubgraph()" class="icon-btn" title="Export"><i class="fa-solid fa-download"></i></button>
                </div>

                <!-- Shortest Path -->
                <div class="control-group" style="margin-top: 10px;">
                    <input type="text" id="sp-source" placeholder="Shortest path: source">
                    <input type="text" id="sp-target" placeholder="target">
                    <button onclick="shortestPath()" class="icon-btn" title="Find shortest path"><i class="fa-solid fa-route"></i></button>
                </div>
            </div>

            <!-- Minimized Chat -->
            <div class="chat-container">
                <div class="chat-header" id="chat-header">
                    <i class="fa-regular fa-comments"></i> AI Assistant
                </div>
                <div class="chat-history" id="chat-history">
                    <div class="message assistant">
                        Hi! Drag & drop files to the graph to start.
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Ask AI...">
                    <button onclick="sendMessage()" class="icon-btn"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <!-- Main Graph Area -->
        <div class="main-content">
            <div id="cy"></div>

            <!-- Drag & Drop Overlay -->
            <div id="drop-zone" class="drop-zone hidden">
                <div class="drop-content">
                    <i class="fa-solid fa-cloud-arrow-up"></i>
                    <h3>Drop files here to upload</h3>
                    <p>Supports .txt, .md, .pdf, .docx, .pptx, .html</p>
                </div>
            </div>

            <div id="loading" class="loading" style="display:none;">
                <div class="spinner"></div>
                <span>Processing...</span>
            </div>
        </div>
    </div>

    <!-- Hidden File Input for Button Click Fallback if needed -->
    <input type="file" id="file-upload" accept=".txt,.md,.pdf,.docx,.pptx,.html" multiple style="display: none;"
        onchange="uploadFile()">

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>

</html>