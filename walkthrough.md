# ğŸ‰ LLM + Neo4j çŸ¥è¯†å›¾è°±é¡¹ç›® - å®Œæ•´æŒ‡å—

## âœ… é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**å®Œå…¨è‡ªåŠ¨åŒ–**çš„çŸ¥è¯†å›¾è°±æ„å»ºç³»ç»Ÿï¼š

```
ğŸ“„ ä¸Šä¼ æ–‡æ¡£ â†’ ğŸ¤– AI åˆ†ææå–å…³ç³» â†’ ğŸ“Š å­˜å…¥ Neo4j â†’ ğŸ¨ å¯è§†åŒ–å±•ç¤º
```

**å…³é”®ç‚¹ï¼šAI ä¼šè‡ªåŠ¨ç†è§£æ–‡æœ¬å¹¶æå–ä¸‰å…ƒç»„ï¼Œæ•°æ®åº“åªå­˜å‚¨ç»“æ„åŒ–çš„å…³ç³»ï¼**

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### 1. ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
```
ç”¨æˆ·é€‰æ‹© TXT/MD æ–‡ä»¶ â†’ å‰ç«¯å‘é€åˆ° Flask åç«¯
```

### 2. AI æ™ºèƒ½æå–ï¼ˆæ ¸å¿ƒæ­¥éª¤ï¼‰
```python
# app.py ä¸­çš„å¤„ç†æµç¨‹
text = "æ±Ÿæ³½æ°‘å‡ºç”Ÿäºæ±Ÿè‹æ‰¬å·ï¼Œæ¯•ä¸šäºä¸Šæµ·äº¤é€šå¤§å­¦ã€‚"

# å‘é€ç»™ DeepSeek LLM
prompt = """
ä½ æ˜¯çŸ¥è¯†å›¾è°±æ„å»ºåŠ©æ‰‹ï¼Œæå–ä¸‰å…ƒç»„ï¼š
(ä¸»ä½“, å…³ç³», å®¢ä½“)

ç¤ºä¾‹ï¼š
- (æ±Ÿæ³½æ°‘, å‡ºç”Ÿäº, æ±Ÿè‹æ‰¬å·)
- (æ±Ÿæ³½æ°‘, æ¯•ä¸šäº, ä¸Šæµ·äº¤é€šå¤§å­¦)
"""

# AI è¿”å›ç»“æ„åŒ–æ•°æ®
triples = [
    {
        "subject": "æ±Ÿæ³½æ°‘",
        "predicate": "å‡ºç”Ÿäº", 
        "object": "æ±Ÿè‹æ‰¬å·",
        "confidence": 1.0,
        "span": "æ±Ÿæ³½æ°‘å‡ºç”Ÿäºæ±Ÿè‹æ‰¬å·"
    },
    {
        "subject": "æ±Ÿæ³½æ°‘",
        "predicate": "æ¯•ä¸šäº",
        "object": "ä¸Šæµ·äº¤é€šå¤§å­¦", 
        "confidence": 1.0,
        "span": "æ¯•ä¸šäºä¸Šæµ·äº¤é€šå¤§å­¦"
    }
]
```

### 3. å†™å…¥ Neo4j
```cypher
# è‡ªåŠ¨æ‰§è¡Œçš„ Cypher æŸ¥è¯¢
MERGE (a:Entity {name: "æ±Ÿæ³½æ°‘"})
MERGE (b:Entity {name: "æ±Ÿè‹æ‰¬å·"})
MERGE (a)-[r:REL {predicate: "å‡ºç”Ÿäº"}]->(b)
SET r.confidence = 1.0, r.source_doc = "æ±Ÿæ³½æ°‘.txt"
```

### 4. å‰ç«¯å¯è§†åŒ–
```
Cytoscape.js ä» /api/graph è·å–æ•°æ® â†’ æ¸²æŸ“äº¤äº’å¼å›¾è°±
```

---

## ğŸš€ å·²å®Œæˆçš„ä¼˜åŒ–

### âœ… ä¿®å¤çš„é—®é¢˜

1. **JSON åºåˆ—åŒ–é”™è¯¯** - è¿‡æ»¤ Neo4j DateTime ç±»å‹
2. **ç®€å•è‹±æ–‡ Prompt** â†’ **ä¼˜åŒ–çš„ä¸­æ–‡ Prompt**
3. **æ–‡æœ¬é•¿åº¦é™åˆ¶** - ä» 4000 æå‡åˆ° 8000 å­—ç¬¦
4. **è°ƒè¯•ä¿¡æ¯** - æ˜¾ç¤ºæå–çš„ä¸‰å…ƒç»„

### âœ… ä¼˜åŒ–åçš„ Prompt

**ä¹‹å‰ï¼ˆç®€å•ï¼‰ï¼š**
```
You are an assistant that extracts factual triples...
```

**ç°åœ¨ï¼ˆè¯¦ç»†ï¼‰ï¼š**
```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŸ¥è¯†å›¾è°±æ„å»ºåŠ©æ‰‹ã€‚è¯·ä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–æ‰€æœ‰æœ‰æ„ä¹‰çš„ä¸‰å…ƒç»„ã€‚

è¦æ±‚ï¼š
1. ä¸‰å…ƒç»„æ ¼å¼ï¼š(ä¸»ä½“, å…³ç³», å®¢ä½“)
2. ä¸»ä½“å’Œå®¢ä½“åº”è¯¥æ˜¯å®ä½“ï¼ˆäººã€åœ°ç‚¹ã€æ¦‚å¿µã€äº‹ç‰©ã€ç»„ç»‡ç­‰ï¼‰
3. å…³ç³»åº”è¯¥æ˜¯åŠ¨è¯æˆ–æè¿°æ€§çŸ­è¯­
4. æ¯ä¸ªä¸‰å…ƒç»„å¿…é¡»æ˜¯äº‹å®æ€§çš„ï¼Œä¸è¦æ¨æµ‹
5. æä¾›ç½®ä¿¡åº¦åˆ†æ•°ï¼ˆ0-1ï¼‰å’ŒåŸæ–‡ç‰‡æ®µ
6. å°½å¯èƒ½å¤šåœ°æå–æœ‰ä»·å€¼çš„å…³ç³»

ç¤ºä¾‹ï¼š
æ–‡æœ¬ï¼š"æ±Ÿæ³½æ°‘å‡ºç”Ÿäºæ±Ÿè‹æ‰¬å·ï¼Œæ¯•ä¸šäºä¸Šæµ·äº¤é€šå¤§å­¦ã€‚"
è¾“å‡ºï¼š
- (æ±Ÿæ³½æ°‘, å‡ºç”Ÿäº, æ±Ÿè‹æ‰¬å·) [confidence: 1.0]
- (æ±Ÿæ³½æ°‘, æ¯•ä¸šäº, ä¸Šæµ·äº¤é€šå¤§å­¦) [confidence: 1.0]
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æµ‹è¯•æ–‡ä»¶ 1ï¼štest.txt
```
å¼ ä¸‰æ˜¯ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆã€‚ä»–åœ¨åŒ—äº¬å·¥ä½œã€‚åŒ—äº¬æ˜¯ä¸­å›½çš„é¦–éƒ½ã€‚
```

**AI ä¼šæå–ï¼š**
- (å¼ ä¸‰, æ˜¯, è½¯ä»¶å·¥ç¨‹å¸ˆ)
- (å¼ ä¸‰, å·¥ä½œäº, åŒ—äº¬)
- (åŒ—äº¬, æ˜¯, ä¸­å›½é¦–éƒ½)

### æµ‹è¯•æ–‡ä»¶ 2ï¼šæ±Ÿæ³½æ°‘.txtï¼ˆéƒ¨åˆ†ï¼‰
```
æ±Ÿæ³½æ°‘å‡ºç”Ÿäºæ±Ÿè‹æ‰¬å·ï¼Œæ¯•ä¸šäºä¸Šæµ·äº¤é€šå¤§å­¦ã€‚
1989å¹´æ‹…ä»»ä¸­å…±ä¸­å¤®æ€»ä¹¦è®°ã€‚
```

**AI ä¼šæå–ï¼š**
- (æ±Ÿæ³½æ°‘, å‡ºç”Ÿäº, æ±Ÿè‹æ‰¬å·)
- (æ±Ÿæ³½æ°‘, æ¯•ä¸šäº, ä¸Šæµ·äº¤é€šå¤§å­¦)
- (æ±Ÿæ³½æ°‘, æ‹…ä»», ä¸­å…±ä¸­å¤®æ€»ä¹¦è®°)
- (æ±Ÿæ³½æ°‘, æ‹…ä»»æ—¶é—´, 1989å¹´)

---

## ğŸ¯ å¦‚ä½•éªŒè¯ AI æ­£åœ¨å·¥ä½œ

### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
cd e:\creat2\llmgnn\backend
..\venv\Scripts\python.exe app.py
```

### 2. ä¸Šä¼ æ–‡ä»¶å¹¶æŸ¥çœ‹ç»ˆç«¯è¾“å‡º
```
Processing file: test.txt, length: 81
ğŸ“ Sending to LLM for extraction...
âœ… Extracted 3 triples
  1. (å¼ ä¸‰) --[æ˜¯]--> (è½¯ä»¶å·¥ç¨‹å¸ˆ)
  2. (å¼ ä¸‰) --[å·¥ä½œäº]--> (åŒ—äº¬)
  3. (åŒ—äº¬) --[æ˜¯]--> (ä¸­å›½é¦–éƒ½)
```

**è¿™è¯æ˜ï¼š**
- âœ… AI è¯»æ‡‚äº†æ–‡æœ¬
- âœ… AI ç†è§£äº†å…³ç³»
- âœ… AI æå–äº†ç»“æ„åŒ–æ•°æ®

### 3. åœ¨ Neo4j Browser ä¸­éªŒè¯
```cypher
MATCH (n)-[r]->(m)
RETURN n.name, r.predicate, m.name
LIMIT 10
```

**ä½ ä¼šçœ‹åˆ°ï¼š**
```
å¼ ä¸‰ | æ˜¯ | è½¯ä»¶å·¥ç¨‹å¸ˆ
å¼ ä¸‰ | å·¥ä½œäº | åŒ—äº¬
åŒ—äº¬ | æ˜¯ | ä¸­å›½é¦–éƒ½
```

---

## ğŸ” è°ƒè¯•å’ŒéªŒè¯

### æŸ¥çœ‹ LLM æå–ç»“æœ
ç»ˆç«¯ä¼šæ˜¾ç¤ºï¼š
```
ğŸ“ Sending to LLM for extraction...
[DEBUG] Starting extraction for text length: 1234
[DEBUG] LLM result type: <class 'dict'>
[DEBUG] Extracted triples count: 5
âœ… Extracted 5 triples
  1. (å®ä½“A) --[å…³ç³»]--> (å®ä½“B)
  ...
```

### æŸ¥çœ‹ Neo4j æ•°æ®
```cypher
// æŸ¥çœ‹æ‰€æœ‰å®ä½“
MATCH (n:Entity) RETURN n.name LIMIT 25

// æŸ¥çœ‹æ‰€æœ‰å…³ç³»
MATCH (a)-[r:REL]->(b) 
RETURN a.name, r.predicate, b.name, r.confidence

// æŸ¥çœ‹æŸä¸ªå®ä½“çš„æ‰€æœ‰å…³ç³»
MATCH (n:Entity {name: "æ±Ÿæ³½æ°‘"})-[r]-(m)
RETURN n, r, m
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ AIï¼Ÿ

### âŒ æ²¡æœ‰ AI çš„æƒ…å†µ
```
æ–‡æœ¬: "æ±Ÿæ³½æ°‘å‡ºç”Ÿäºæ±Ÿè‹æ‰¬å·"
æ•°æ®åº“: åªèƒ½å­˜å‚¨åŸå§‹æ–‡æœ¬ï¼Œæ— æ³•ç†è§£å…³ç³»
```

### âœ… æœ‰ AI çš„æƒ…å†µ
```
æ–‡æœ¬: "æ±Ÿæ³½æ°‘å‡ºç”Ÿäºæ±Ÿè‹æ‰¬å·"
AI ç†è§£: 
  - ä¸»ä½“: æ±Ÿæ³½æ°‘ï¼ˆäººç‰©ï¼‰
  - å…³ç³»: å‡ºç”Ÿäºï¼ˆåœ°ç†å…³ç³»ï¼‰
  - å®¢ä½“: æ±Ÿè‹æ‰¬å·ï¼ˆåœ°ç‚¹ï¼‰
æ•°æ®åº“: å­˜å‚¨ç»“æ„åŒ–ä¸‰å…ƒç»„ï¼Œå¯ä»¥æŸ¥è¯¢å’Œæ¨ç†
```

---

## ğŸ› ï¸ æŠ€æœ¯ç»†èŠ‚

### LLM é…ç½®
```python
# app.py
llm = ChatOpenAI(
    temperature=0,              # ç¡®ä¿è¾“å‡ºç¨³å®š
    model_name="deepseek-chat", # ä½¿ç”¨ DeepSeek
    api_key=DEEPSEEK_API_KEY,
    base_url=DEEPSEEK_BASE_URL
)
```

### è¾“å‡ºè§£æ
```python
# ä½¿ç”¨ Pydantic ç¡®ä¿ç»“æ„åŒ–è¾“å‡º
class Triple(BaseModel):
    subject: str
    predicate: str
    object: str
    confidence: float
    span: str

parser = JsonOutputParser(pydantic_object=TriplesOutput)
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æ“ä½œ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| æ–‡ä»¶ä¸Šä¼  | < 1s | å°æ–‡ä»¶ |
| LLM æå– | 3-10s | å–å†³äºæ–‡æœ¬é•¿åº¦ |
| Neo4j å†™å…¥ | < 1s | æ‰¹é‡å†™å…¥ |
| å›¾è°±æ¸²æŸ“ | < 2s | 100 ä¸ªèŠ‚ç‚¹å†… |

---

## ğŸ¨ å‰ç«¯ç•Œé¢åŠŸèƒ½

1. **æ–‡ä»¶ä¸Šä¼ ** - æ‹–æ‹½æˆ–é€‰æ‹©æ–‡ä»¶
2. **å›¾è°±å¯è§†åŒ–** - äº¤äº’å¼èŠ‚ç‚¹å’Œè¾¹
3. **æœç´¢** - æŒ‰å®ä½“åç§°æœç´¢
4. **èŠå¤©** - åŸºäºå›¾è°±çš„é—®ç­”
5. **åˆ·æ–°** - é‡æ–°åŠ è½½å›¾è°±

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯åš
1. âœ… ä¸Šä¼  [test.txt](file:///e:/creat2/llmgnn/test.txt) æµ‹è¯•åŸºç¡€åŠŸèƒ½
2. âœ… ä¸Šä¼  `æ±Ÿæ³½æ°‘.txt` æµ‹è¯•å¤æ‚æ–‡æœ¬
3. âœ… åœ¨ Neo4j Browser ä¸­æŸ¥çœ‹ç»“æœ

### åŠŸèƒ½å¢å¼º
1. **PDF æ”¯æŒ** - å®‰è£… `PyPDF2`
2. **é•¿æ–‡æ¡£åˆ†å—** - è‡ªåŠ¨åˆ†æ®µå¤„ç†
3. **å®ä½“æ¶ˆæ­§** - åˆå¹¶åŒä¹‰å®ä½“
4. **å…³ç³»åˆ†ç±»** - è‡ªåŠ¨åˆ†ç±»å…³ç³»ç±»å‹

### é«˜çº§åŠŸèƒ½
1. **å¤šè·³æ¨ç†** - å¤æ‚é—®ç­”
2. **æ—¶é—´è½´** - æ—¶é—´åºåˆ—å¯è§†åŒ–
3. **ç¤¾åŒºæ£€æµ‹** - å›¾è°±èšç±»
4. **çŸ¥è¯†æ¨ç†** - åŸºäºè§„åˆ™çš„æ¨ç†

---

## âœ¨ æ€»ç»“

**ä½ çš„ç³»ç»Ÿç°åœ¨æ˜¯è¿™æ ·å·¥ä½œçš„ï¼š**

```
1. ğŸ“„ ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£
   â†“
2. ğŸ¤– DeepSeek AI é˜…è¯»å¹¶ç†è§£æ–‡æœ¬
   â†“
3. ğŸ§  AI æå–ç»“æ„åŒ–ä¸‰å…ƒç»„ï¼ˆä¸»ä½“-å…³ç³»-å®¢ä½“ï¼‰
   â†“
4. ğŸ’¾ Neo4j å­˜å‚¨å›¾è°±æ•°æ®
   â†“
5. ğŸ¨ Cytoscape.js å¯è§†åŒ–å±•ç¤º
   â†“
6. ğŸ’¬ ç”¨æˆ·å¯ä»¥æŸ¥è¯¢å’ŒèŠå¤©
```

**å…³é”®ä¼˜åŠ¿ï¼š**
- âœ… å®Œå…¨è‡ªåŠ¨åŒ–
- âœ… AI ç†è§£è¯­ä¹‰
- âœ… ç»“æ„åŒ–å­˜å‚¨
- âœ… å¯è§†åŒ–å±•ç¤º
- âœ… æ™ºèƒ½é—®ç­”

ç°åœ¨è¯•è¯•ä¸Šä¼  [test.txt](file:///e:/creat2/llmgnn/test.txt) æˆ– `æ±Ÿæ³½æ°‘.txt`ï¼Œçœ‹çœ‹ AI å¦‚ä½•æå–å…³ç³»ï¼ğŸš€
